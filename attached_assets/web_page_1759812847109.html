<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Indian Mammal Species Identifier</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
  background:#1a1a1a; color:#fff; min-height:100vh; padding:40px 20px;
}
.container { max-width:800px; margin:0 auto; text-align:center; }
.header { margin-bottom:40px; }
.paw-icon { font-size:48px; margin-bottom:20px; opacity:0.8; background-color:#eb0e11; border-radius:50%; padding:10px; display:inline-block; }
.title { font-size:48px; font-weight:bold; margin-bottom:30px; line-height:1.2; }
.description { font-size:16px; color:#ccc; margin-bottom:20px; line-height:1.5; }
.upload-section { margin:40px 0; }

.upload-label {
  font-size:16px; color:#fff; display:block; text-align:left;
  max-width:600px; margin:0 auto 20px;
}

.upload-area {
  background:#2a2a2a; border:2px dashed #555; border-radius:12px;
  padding:40px; max-width:600px; margin:0 auto;
  cursor:pointer; transition:all 0.3s ease; position:relative;
}
.upload-area:hover { border-color:#777; background:#333; }
.upload-area.dragover { border-color:#4a9eff; background:#1a3a5c; }

.upload-inner { display:flex; flex-direction:column; align-items:center; justify-content:center; transition:opacity 0.3s; }
.upload-icon { font-size:48px; color:#666; margin-bottom:20px; }
.upload-text { font-size:18px; color:#ccc; margin-bottom:10px; }
.upload-subtext { font-size:14px; color:#999; text-align:center; }

.file-input { position:absolute; left:-9999px; }

.preview-image {
  max-width:100%; max-height:250px; border-radius:8px;
  display:none; margin-bottom:10px; object-fit:contain;
}

.loading { color:#4a9eff; font-size:16px; margin:10px 0; display:none; }
.result-text { font-size:18px; color:#4a9eff; margin-top:8px; display:none; }

.browse-btn {
  background:#4a4a4a; color:#fff; border:none;
  padding:12px 24px; border-radius:6px; cursor:pointer;
  font-size:14px; margin-top:20px; transition:background 0.3s;
}
.browse-btn:hover { background:#555; }
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <div class="paw-icon">üêæ</div>
    <h1 class="title">Indian Mammal Species<br>Identifier</h1>
    <p class="description">Upload a clear image of a Mammal from the Indian subcontinent.</p>
    <p class="description">The AI Model will identify the mammal name.</p>
  </div>

  <div class="upload-section">
    <label class="upload-label">Upload Mammal Image (JPEG/PNG)</label>

    <div class="upload-area" id="uploadArea">
      <div class="upload-inner" id="uploadInner">
        <div class="upload-icon">‚òÅÔ∏è</div>
        <div class="upload-text">Drag and drop file here</div>
        <div class="upload-subtext">Limit 200MB per file ‚Ä¢ JPG, JPEG, PNG</div>
      </div>

      <img id="previewImage" class="preview-image" alt="Preview">
      <div id="loadingText" class="loading">Processing image...</div>
      <div id="resultText" class="result-text"></div>

      <input type="file" id="fileInput" class="file-input" accept="image/*">
    </div>

    <div style="margin-top:20px;">
      <button type="button" id="browseBtn" class="browse-btn">Browse files</button>
      <button type="button" id="resetBtn" class="browse-btn" style="background:#b33203; margin-left:10px;">Reset</button>
    </div>
  </div>
</div>

<script>
const fileInput = document.getElementById('fileInput');
const uploadArea = document.getElementById('uploadArea');
const uploadInner = document.getElementById('uploadInner');
const browseBtn = document.getElementById('browseBtn');
const resetBtn = document.getElementById('resetBtn');
const previewImage = document.getElementById('previewImage');
const loadingText = document.getElementById('loadingText');
const resultText = document.getElementById('resultText');

let isOpeningDialog = false;

// ------------------ Drag & Drop ------------------
uploadArea.addEventListener('dragover', e => {
  e.preventDefault();
  uploadArea.classList.add('dragover');
});
uploadArea.addEventListener('dragleave', e => {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
});
uploadArea.addEventListener('drop', e => {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
  const f = e.dataTransfer.files && e.dataTransfer.files[0];
  if (f) handleFile(f);
});

// ------------------ Click Events ------------------
uploadArea.addEventListener('click', e => {
  if (isOpeningDialog) return;
  if (e.target.closest('button')) return;
  isOpeningDialog = true;
  fileInput.click();
  setTimeout(() => (isOpeningDialog = false), 500);
});
browseBtn.addEventListener('click', e => {
  e.stopImmediatePropagation();
  if (isOpeningDialog) return;
  isOpeningDialog = true;
  fileInput.click();
  setTimeout(() => (isOpeningDialog = false), 500);
});
resetBtn.addEventListener('click', resetAll);

// ------------------ File Input ------------------
fileInput.addEventListener('click', () => { fileInput.value = ""; });
fileInput.addEventListener('change', e => {
  const f = e.target.files && e.target.files[0];
  if (f) handleFile(f);
});

// ------------------ Handle Upload ------------------
function handleFile(file) {
  if (!file || !file.type.startsWith('image/')) {
    alert('Please upload an image file');
    return;
  }
  if (file.size > 200 * 1024 * 1024) {
    alert('File size must be less than 200MB');
    return;
  }

  // Hide text & show image preview
  uploadInner.style.display = 'none';
  previewImage.style.display = 'block';
  loadingText.style.display = 'block';
  resultText.style.display = 'none';
  resultText.innerHTML = '';

  const reader = new FileReader();
  reader.onload = function(e) {
    previewImage.src = e.target.result;

    const formData = new FormData();
    formData.append('file', file);

    fetch('/predict', { method: 'POST', body: formData })
      .then(res => res.json())
      .then(data => {
        loadingText.style.display = 'none';
        resultText.style.display = 'block';
        resultText.innerHTML = data.prediction;
        resultText.style.color = 'lightgreen';
      })
      .catch(err => {
        loadingText.style.display = 'none';
        resultText.style.display = 'block';
        resultText.innerHTML = 'Error: ' + err;
        resultText.style.color = 'red';
      });
  };
  reader.readAsDataURL(file);
}

// ------------------ Reset ------------------
function resetAll() {
  previewImage.src = "";
  previewImage.style.display = 'none';
  uploadInner.style.display = 'flex';
  loadingText.style.display = 'none';
  resultText.style.display = 'none';
  resultText.innerHTML = '';
  fileInput.value = "";
}
</script>
</body>
</html>
